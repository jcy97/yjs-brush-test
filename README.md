# 다중 캔버스 실시간 협업 브러시

YJS를 활용한 고도화된 실시간 협업 그림 그리기 애플리케이션입니다. 하나의 프로젝트에서 여러 캔버스를 관리하고, 여러 사용자가 동시에 다른 캔버스에서 작업할 수 있습니다.

## 🚀 주요 기능

### 다중 캔버스 지원

- **프로젝트 단위 관리**: 하나의 프로젝트에 여러 캔버스 생성 가능
- **독립적인 캔버스**: 각 캔버스는 별도의 YJS 문서로 관리되어 완전히 독립적
- **실시간 전환**: 캔버스 간 즉시 전환 가능
- **캔버스별 사용자 추적**: 각 캔버스에 몇 명이 접속해 있는지 실시간 확인

### 실시간 협업

- **동시 편집**: 여러 사용자가 같은 캔버스에서 동시에 그림 그리기
- **실시간 커서**: 다른 사용자의 마우스 커서 실시간 표시
- **즉시 동기화**: 모든 그림 데이터가 실시간으로 동기화
- **사용자 식별**: 각 사용자별 고유 색상으로 구분

### 고급 기능

- **브러시 커스터마이징**: 크기, 색상 조절
- **모바일 지원**: 터치 디바이스에서도 완벽 동작
- **캔버스 관리**: 캔버스 추가, 삭제, 이름 변경
- **자동 저장**: 모든 변경사항이 자동으로 저장됨

## 🏗️ 아키텍처

### YJS 문서 구조

```
프로젝트별 메타데이터: project-meta-{projectId}
├── canvases: Y.Array<ProjectCanvas>    // 캔버스 목록
└── userLocations: Y.Map<string>        // 사용자별 현재 위치

캔버스별 데이터: project-{projectId}-canvas-{canvasId}
├── strokes: Y.Array<BrushStroke>       // 그림 데이터
└── users: Y.Map<User>                  // 사용자 정보
```

### 핵심 클래스

#### 1. ProjectManager

- 프로젝트 메타데이터 관리
- 캔버스 목록 및 사용자 위치 추적
- 프로젝트 레벨 이벤트 처리

#### 2. CanvasManager

- 개별 캔버스 관리
- 그리기 엔진 및 YJS 동기화
- 사용자 상호작용 처리

#### 3. MultiCanvasApp

- 전체 애플리케이션 조율
- UI 상태 관리
- 캔버스 간 전환 제어

## 🛠️ 설치 및 실행

### 1. 의존성 설치

```bash
npm install
```

### 2. 개발 서버 실행 (클라이언트 + 서버 동시)

```bash
npm run dev
```

### 3. 서버만 실행

```bash
npm run server:only
```

### 4. 클라이언트만 실행 (서버가 별도로 실행 중일 때)

```bash
npm run client
```

## 🌐 사용법

### 프로젝트 접근

- URL: `http://localhost:3000#project-{projectId}`
- 예시: `http://localhost:3000#project-team-alpha`
- 프로젝트 ID가 없으면 자동으로 새 프로젝트 생성

### 캔버스 관리

1. **새 캔버스 추가**: 사이드바의 "새 캔버스 추가" 버튼 클릭
2. **캔버스 선택**: 사이드바에서 원하는 캔버스 클릭
3. **캔버스 삭제**: 캔버스 선택 후 "캔버스 삭제" 버튼 클릭

### 협업 작업

1. 같은 프로젝트 URL을 팀원들과 공유
2. 각자 원하는 캔버스에서 작업
3. 실시간으로 다른 사용자의 작업 확인 가능

## 📁 프로젝트 구조

```
src/
├── core/
│   ├── ProjectManager.ts       # 프로젝트 메타데이터 관리
│   ├── CanvasManager.ts        # 개별 캔버스 관리
│   └── YjsManager.ts          # (기존, 참고용)
├── types/
│   └── brush.ts               # 타입 정의
├── utils/
│   └── canvas.ts              # 캔버스 유틸리티
└── main.ts                    # 메인 애플리케이션
```

## 🔧 기술 스택

- **Frontend**: TypeScript, HTML5 Canvas
- **Real-time Sync**: YJS + WebSocket
- **Build Tool**: Vite
- **Styling**: Pure CSS

## 🎯 사용 시나리오

### 시나리오 1: 팀 디자인 작업

- 프로젝트: `design-sprint-2024`
- 캔버스: `wireframe`, `mockup`, `user-flow`
- 각 팀원이 서로 다른 캔버스에서 동시 작업

### 시나리오 2: 교육용 화이트보드

- 프로젝트: `math-class-room1`
- 캔버스: `lesson1`, `lesson2`, `practice`
- 선생님과 학생들이 각 레슨별로 협업

### 시나리오 3: 브레인스토밍

- 프로젝트: `product-planning`
- 캔버스: `ideas`, `analysis`, `roadmap`
- 팀원들이 단계별로 아이디어 발전

## 💡 확장 가능성

### 가능한 개선사항

1. **권한 관리**: 캔버스별 읽기/쓰기 권한 설정
2. **버전 관리**: 캔버스 히스토리 및 복원 기능
3. **내보내기**: PNG, SVG 등 다양한 형식으로 내보내기
4. **템플릿**: 미리 정의된 캔버스 템플릿 제공
5. **음성/채팅**: 실시간 음성 또는 텍스트 채팅 통합

### 성능 최적화

- 캔버스별 지연 로딩
- 대용량 그림 데이터 압축
- 네트워크 상태에 따른 동기화 조절

## 🤝 YJS 아키텍처 선택 이유

### 캔버스별 별도 Y.Doc 사용의 장점

1. **성능**: 필요한 캔버스만 로드하여 메모리 효율성
2. **확장성**: 캔버스 수가 증가해도 성능 영향 최소화
3. **격리**: 캔버스 간 완전한 데이터 격리로 안정성 확보
4. **네트워크**: 사용 중인 캔버스만 네트워크 트래픽 발생

### 단일 Y.Doc 대비 이점

- 불필요한 데이터 동기화 방지
- 캔버스별 독립적인 연결 관리
- 장애 발생 시 다른 캔버스에 영향 없음

## 📄 라이선스

MIT License - 자유롭게 사용, 수정, 배포 가능합니다.
